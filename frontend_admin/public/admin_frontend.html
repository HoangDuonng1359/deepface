<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="logo_uet.webp">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - H·ªá th·ªëng ƒëi·ªÉm danh</title>
    <link rel="stylesheet" href="admin_style.css">
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="dejavusans_base64.js"></script>
</head>
<body>
    <div class="container">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="header" style="display: flex; flex-direction: column; align-items: center; cursor: pointer;">
                <img src="logo_uet.webp" alt="Logo UET-VNU"
                    style="height: 60px; margin-bottom: 5px; cursor: pointer;"
                    onclick="location.reload()">
                <div style="font-size: 14px;">ƒê·∫°i h·ªçc C√¥ng ngh·ªá</div>
            </div>
            <div class="sidebar-menu">
                <div class="menu-group">
                    <div class="menu-group-title">trang ch·ªß</div>
                    <div class="menu-item" onclick="showPage('home', event)">
                        <i data-feather="home" style="margin-right: 8px;"></i> Dashboard
                    </div>
                </div>
                <div class="menu-group">
                    <div class="menu-group-title">sinh vi√™n</div>
                    <div class="menu-item" onclick="showPage('view-students', event)">
                        <i data-feather="users" style="margin-right: 8px;"></i> Xem sinh vi√™n
                    </div>
                </div>
                <div class="menu-group">
                    <div class="menu-group-title">kh√≥a h·ªçc</div>
                    <div class="menu-item" onclick="showPage('view-classes')">
                        <i data-feather="book-open" style="margin-right: 8px;"></i> Xem l·ªõp h·ªçc
                    </div>
                </div>
            </div>
        </div>
        <!-- Content Area -->
        <div class="content-area">
            <!-- Admin Home Page -->
            <div id="home" class="page active">
                <div class="welcome-card">
                    <h2>Xin ch√†o, Qu·∫£n tr·ªã vi√™n!</h2>
                    <p>Ch√†o m·ª´ng ƒë·∫øn v·ªõi h·ªá th·ªëng qu·∫£n l√Ω ƒëi·ªÉm danh. S·ª≠ d·ª•ng menu b√™n tr√°i ƒë·ªÉ qu·∫£n l√Ω sinh vi√™n v√† l·ªõp h·ªçc.</p>
                </div>
                
                <div class="stats-container">
                    <div class="stat-card students" onclick="showPage('view-students')">
                        <i data-feather="users" class="stat-icon"></i>
                        <h3>T·ªïng s·ªë sinh vi√™n</h3>
                        <div id="total-students" class="number">...</div>
                        <div class="sub-text">T·ªïng s·ªë sinh vi√™n ƒë√£ ƒëƒÉng k√Ω</div>
                    </div>

                    <div class="stat-card classes" onclick="showPage('view-classes')">
                        <i data-feather="book-open" class="stat-icon"></i>
                        <h3>L·ªõp h·ªçc ƒëang ho·∫°t ƒë·ªông</h3>
                        <div id="total-courses" class="number">...</div>
                        <div class="sub-text">S·ªë l·ªõp h·ªçc hi·ªán c√≥ trong h·ªá th·ªëng</div>
                    </div>
                </div>
            </div>

            <!-- View Students Page -->
            <div id="view-students" class="page">
                <div class="page-title">Xem sinh vi√™n</div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <div class="search-box-horizontal">
                        <input id="class-search-id" class="standard-input" type="text" placeholder="T√¨m theo MSSV">
                        <input id="class-search-name" class="standard-input" type="text" placeholder="T√¨m theo t√™n">
                        <button class="search-btn" onclick="filterStudents()">
                            <i data-feather="search"></i>
                        </button>
                    </div>
                    <button class="btn btn-success" onclick="openAddStudentModal()">+ Th√™m sinh vi√™n</button>
                </div>

                <table class="table">
                    <thead>
                        <tr>
                            <th>MSSV</th>
                            <th>H·ªç v√† t√™n</th>
                            <th>Ni√™n kh√≥a</th>
                            <th style="width: 100px;">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

            <!-- View Classes Page -->
            <div id="view-classes" class="page">
                <div class="page-title">Xem l·ªõp h·ªçc</div>
                <div class="search-box-horizontal">
                    <input id="search-course-id" class="standard-input" type="text" placeholder="T√¨m theo m√£ l·ªõp">
                    <input id="search-course-name" class="standard-input" type="text" placeholder="T√¨m theo t√™n m√¥n h·ªçc">
                    <button class="search-btn" onclick="filterCourses()">
                        <i data-feather="search"></i>
                    </button>
                </div>
                <div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
                <button class="btn btn-success" onclick="openAddClassModal()">+ Th√™m l·ªõp h·ªçc</button>
                </div>
                <table class="table">
                <thead>
                    <tr>
                    <th>M√£ l·ªõp</th>
                    <th>T√™n m√¥n h·ªçc</th>
                    <th>Gi·∫£ng vi√™n</th>
                    <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody></tbody> 
                </table>
            </div>
        </div>
    </div>

        <!-- Modal xem chi ti·∫øt l·ªõp h·ªçc -->
    <div id="class-detail-modal" class="modal-overlay">
        <div class="modal-content">
            <h2 style="margin-bottom: 15px;">Chi ti·∫øt l·ªõp h·ªçc</h2>
            <p><strong>M√£ l·ªõp:</strong> <span id="detail-course-id"></span></p>
            <p><strong>T√™n m√¥n h·ªçc:</strong> <span id="detail-course-name"></span></p>
            <p><strong>Gi·∫£ng vi√™n:</strong> <span id="detail-teacher-name"></span></p>
            <p><strong>S·ªë sinh vi√™n:</strong> <span id="detail-num-student"></span></p>

            <!-- ‚úÖ B·∫£ng cu·ªôn n·∫øu danh s√°ch d√†i -->
            <div class="modal-table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>MSSV</th>
                            <th>H·ªç v√† t√™n</th>
                        </tr>
                    </thead>
                    <tbody id="detail-student-list"></tbody>
                </table>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="openAttendanceHistory()">üìã Xem l·ªãch s·ª≠ ƒëi·ªÉm danh</button>
                    <button class="btn btn-success" onclick="exportClassToPDF()">üìÑ Xu·∫•t PDF</button>
                </div>
                <button class="btn btn-danger" onclick="closeClassDetail()">ƒê√≥ng</button>
            </div>
        </div>
    </div>
    <!-- Modal chi ti·∫øt sinh vi√™n -->
    <div id="student-detail-modal" class="modal-overlay">
    <div class="modal-content">
        <h2 style="margin-bottom: 15px;">Chi ti·∫øt sinh vi√™n</h2>
        <p><strong>M√£ sinh vi√™n:</strong> <span id="detail-student-id"></span></p>
        <p><strong>H·ªç v√† t√™n:</strong> <span id="detail-student-name"></span></p>
        <p><strong>Ni√™n kh√≥a:</strong> <span id="detail-student-cohort"></span></p>
        <p><strong>·∫¢nh nh·∫≠n d·∫°ng:</strong></p>
        <div id="student-images" style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px;"></div>

        <div style="text-align: right; margin-top: 15px;">
        <button class="btn btn-danger" onclick="closeStudentDetail()">ƒê√≥ng</button>
        </div>
    </div>
    </div>

    <!-- Modal ch·ªânh s·ª≠a sinh vi√™n -->
    <div id="edit-student-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3>Ch·ªânh s·ª≠a sinh vi√™n</h3>
        <div class="form-group">
        <label>MSSV</label>
        <input type="text" id="edit-mssv" disabled />
        </div>
        <div class="form-group">
        <label>H·ªç v√† t√™n</label>
        <input type="text" id="edit-name" />
        </div>
        <div class="form-group">
        <label>Ni√™n kh√≥a</label>
        <input type="text" id="edit-cohort" placeholder="VD: K68-IT1">
        </div>
        <div class="student-cards" id="edit-photo-container">
        <!-- ·∫£nh s·∫Ω ƒë∆∞·ª£c render t·ª± ƒë·ªông -->
        <div class="student-card add-card" onclick="openPhotoOptionMenu(event)">
            <span>+</span>
        </div>
        </div>
        <input type="file" id="image-input" accept="image/*" style="display: none" onchange="handleImageUpload(event)">
        <div style="text-align: right; margin-top: 15px;">
        <button class="btn btn-success" onclick="saveStudentFromModal()">L∆∞u</button>
        <button class="btn" onclick="closeEditStudentModal()">H·ªßy</button>
        </div>
    </div>
    </div>

    <!-- Modal th√™m sinh vi√™n -->
    <div id="add-student-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3>Th√™m sinh vi√™n</h3>
        <div class="form-group">
        <label>MSSV</label>
        <input type="text" id="add-mssv" />
        </div>
        <div class="form-group">
        <label>H·ªç v√† t√™n</label>
        <input type="text" id="add-name" />
        </div>
        <div class="form-group">
        <label>Ni√™n kh√≥a</label>
        <input type="text" id="add-cohort" placeholder="VD: K68-IT2">
        </div>
        <div class="student-cards" id="add-photo-container">
        <div class="student-card add-card" onclick="openPhotoOptionMenu(event)">
            <span>+</span>
        </div>
        </div>
        <input type="file" id="image-input" accept="image/*" style="display: none" onchange="handleImageUpload(event)">
        <div style="text-align: right; margin-top: 15px;">
        <button class="btn btn-success" onclick="saveNewStudent()">Th√™m</button>
        <button class="btn" onclick="closeAddStudentModal()">H·ªßy</button>
        </div>
    </div>
    </div>

    <!-- Modal s·ª≠a l·ªõp h·ªçc -->
    <div id="edit-class-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3>Ch·ªânh s·ª≠a l·ªõp h·ªçc</h3>
        <div class="form-group">
        <label>M√£ l·ªõp h·ªçc</label>
        <input type="text" id="edit-class-id" disabled />
        </div>
        <div class="form-group">
        <label>T√™n m√¥n h·ªçc</label>
        <input type="text" id="edit-class-name" />
        </div>
        <div class="form-group">
        <label>Gi·∫£ng vi√™n</label>
        <input type="text" id="edit-teacher-name" />
        </div>
        <label style="font-weight: 500;">Danh s√°ch sinh vi√™n:</label>
        <div class="modal-table-container">
        <table class="table">
            <thead>
            <tr>
                <th style="width: 30%;">MSSV</th>
                <th style="width: 50%;">H·ªç v√† t√™n</th>
                <th style="width: 20%; text-align: center;">H√†nh ƒë·ªông</th>
            </tr>
            </thead>
            <tbody id="edit-class-student-body">
            <!-- JS render -->
            </tbody>
        </table>
        </div>
        <div style="text-align: center; margin-top: 10px;">
        <button class="icon-btn" onclick="addStudentRowToEditClass()" title="Th√™m sinh vi√™n m·ªõi">
            <i data-feather="plus"></i>
        </button>
        </div>
        <div style="margin-top: 20px; text-align: right;">
        <button class="btn btn-success" onclick="saveEditedClass()">L∆∞u l·ªõp h·ªçc</button>
        <button class="btn" onclick="closeEditClassModal()">H·ªßy</button>
        </div>
    </div>
    </div>

    <!-- Modal th√™m l·ªõp h·ªçc -->
    <div id="add-class-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content" style="max-width: 800px;">
        <h3>Th√™m l·ªõp h·ªçc</h3>
        <div class="form-group">
        <label>M√£ l·ªõp h·ªçc</label>
        <input type="text" id="course-id" placeholder="Nh·∫≠p m√£ l·ªõp h·ªçc">
        </div>
        <div class="form-group">
        <label>T√™n m√¥n h·ªçc</label>
        <input type="text" id="course-name" placeholder="Nh·∫≠p t√™n m√¥n h·ªçc">
        </div>
        <div class="form-group">
        <label>Gi·∫£ng vi√™n</label>
        <input type="text" id="teacher-name" placeholder="Nh·∫≠p t√™n gi·∫£ng vi√™n">
        </div>
        <label style="font-weight: 500;">Danh s√°ch sinh vi√™n:</label>
        <div class="modal-table-container" style="max-height: 420px; overflow-y: auto; margin-top: 10px;">
        <table class="table">
            <thead>
            <tr>
                <th style="width: 30%;">MSSV</th>
                <th style="width: 50%;">H·ªç v√† t√™n</th>
                <th style="width: 20%; text-align: center;">H√†nh ƒë·ªông</th>
            </tr>
            </thead>
            <tbody id="add-class-student-table"></tbody>
        </table>
        </div>
        <div style="text-align: center; margin-top: 10px;">
        <button class="icon-btn" onclick="addStudentRow()" title="Th√™m sinh vi√™n m·ªõi">
            <i data-feather="plus"></i>
        </button>
        </div>
        <div style="margin-top: 20px; text-align: right;">
        <button class="btn btn-success" onclick="createNewClass()">Th√™m l·ªõp</button>
        <button class="btn" onclick="closeAddClassModal()">H·ªßy</button>
        </div>
    </div>
    </div>
    <div id="attendance-history-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>L·ªãch s·ª≠ ƒëi·ªÉm danh</h3>
            <div class="modal-table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>M√£ ca</th>
                            <th>B·∫Øt ƒë·∫ßu</th>
                            <th>K·∫øt th√∫c</th>
                            <th>ƒê√∫ng gi·ªù</th>
                            <th>ƒêi mu·ªôn</th>
                            <th>V·∫Øng</th>
                        </tr>
                    </thead>
                    <tbody id="attendance-history-body"></tbody>
                </table>
            </div>
            <div style="text-align: right; margin-top: 15px;">
                <button class="btn" onclick="closeAttendanceHistory()">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Modal: Kh√¥ng t√¨m th·∫•y sinh vi√™n -->
    <div id="no-result-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3>Kh√¥ng t√¨m th·∫•y sinh vi√™n</h3>
        <p>Kh√¥ng c√≥ sinh vi√™n n√†o kh·ªõp v·ªõi ƒëi·ªÅu ki·ªán t√¨m ki·∫øm c·ªßa b·∫°n.</p>
        <button class="btn" onclick="closeNoResultModal()">ƒê√≥ng</button>
    </div>
    </div>

    <!-- Modal: Kh√¥ng t√¨m th·∫•y l·ªõp h·ªçc -->
    <div id="no-course-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <h3>Kh√¥ng t√¨m th·∫•y l·ªõp h·ªçc</h3>
        <p>Kh√¥ng c√≥ l·ªõp h·ªçc n√†o kh·ªõp v·ªõi ƒëi·ªÅu ki·ªán t√¨m ki·∫øm c·ªßa b·∫°n.</p>
        <button class="btn" onclick="closeNoCourseModal()">ƒê√≥ng</button>
    </div>
    </div>

    <div id="photo-option-menu" style="
        display: none;
        position: fixed;
        z-index: 99999;
        background: white;
        border: 1px solid #ccc;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        padding: 8px;
    ">
        <button class="btn btn-sm" onclick="triggerImageUpload()">üìÅ T·∫£i ·∫£nh l√™n</button>
        <button class="btn btn-sm" onclick="triggerWebcamCapture()">üì∑ Ch·ª•p ·∫£nh</button>
    </div>

    <script>
        feather.replace();
    </script>
    <script src="admin_js.js"></script>
</body>
</html>